<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://4l0n3r.github.io/ name=base><title>
            
                First Flight 1 : PasswordStore
            
        </title><meta content="First Flight 1 : PasswordStore" property=og:title><meta content="Aka S0m30n3" property=og:description><meta content="Aka S0m30n3" name=description><link href=/favicons/favicon.ico rel=icon type=image/png><link href=https://4l0n3r.github.io/fonts.css rel=stylesheet><script src=https://4l0n3r.github.io/js/codeblock.js></script><script src=https://4l0n3r.github.io/js/toc.js></script><script src=https://4l0n3r.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link href=https://4l0n3r.github.io/atom.xml rel=alternate title=Johny type=application/atom+xml><link href=https://4l0n3r.github.io/theme/light.css rel=stylesheet><link href=https://4l0n3r.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://4l0n3r.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://4l0n3r.github.io/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://4l0n3r.github.io/>Johny</a><div class=socials><a class=social href=https://x.com/0xJ0hny rel=me> <img alt=twitter src=https://4l0n3r.github.io/icons/social/twitter.svg> </a><a class=social href=https://github.com/4l0n3r/ rel=me> <img alt=github src=https://4l0n3r.github.io/icons/social/github.svg> </a><a class=social href=https://www.linkedin.com/in/johny-vasamsettti/ rel=me> <img alt=linkedin src=https://4l0n3r.github.io/icons/social/linkedin.svg> </a><a href="mailto: vasamsetti.johny@gmail.com" class=social rel=me> <img alt=Email src=https://4l0n3r.github.io/icons/social/email.svg> </a></div></div><nav><a href=https://4l0n3r.github.io/posts style=margin-left:.25em>/posts</a><a href=https://4l0n3r.github.io/writeups style=margin-left:.25em>/writeups</a><a href=https://4l0n3r.github.io/projects style=margin-left:.25em>/projects</a><a href=https://4l0n3r.github.io/tags style=margin-left:.25em>/tags</a><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://4l0n3r.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://4l0n3r.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><main><article><div class=title><div class=page-header>First Flight 1 : PasswordStore<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2023-10-25</time> :: 418 Words</div></div><div class=toc-container><h1 class=toc-title>Table of Contents</h1><ul class=toc-list><li><a href=https://4l0n3r.github.io/writeups/first-flight-1-paawordstore/#high>High</a> <ul><li><a href=https://4l0n3r.github.io/writeups/first-flight-1-paawordstore/#h1-storing-password-on-chain-makes-it-visible-to-anyone>[H1] Storing password on-chain makes it visible to anyone</a><li><a href=https://4l0n3r.github.io/writeups/first-flight-1-paawordstore/#h2-passwordstore-setpassword-has-no-access-control-vulnerable-to-non-owner-to-change-it>[H2] PasswordStore::setPassword has no access control, vulnerable to non-owner to change it.</a></ul><li><a href=https://4l0n3r.github.io/writeups/first-flight-1-paawordstore/#low>Low</a> <ul><li><a href=https://4l0n3r.github.io/writeups/first-flight-1-paawordstore/#l1-initialization-timeframe-vulnerability>[L1] Initialization Timeframe Vulnerability</a></ul><li><a href=https://4l0n3r.github.io/writeups/first-flight-1-paawordstore/#informative>Informative</a> <ul><li><a href=https://4l0n3r.github.io/writeups/first-flight-1-paawordstore/#i1-netspec-indicates-a-parameter-that-doesn-t-exist-causing-netspec-incorrect>[I1] Netspec indicates a parameter that doesn't exist, causing netspec incorrect.</a></ul></ul></div><section class=body><h1 id=high><a aria-label="Anchor link for: high" class=zola-anchor href=#high>High</a></h1><h2 id=h1-storing-password-on-chain-makes-it-visible-to-anyone><a aria-label="Anchor link for: h1-storing-password-on-chain-makes-it-visible-to-anyone" class=zola-anchor href=#h1-storing-password-on-chain-makes-it-visible-to-anyone>[H1] Storing password on-chain makes it visible to anyone</a></h2><p><strong>Description:</strong> The data that we stored at <code>PasswordStore:s_password</code> is intended to be private and only visible to the owner. since it was placed on chain, everything that we store on-chain is visible to everyone.<p><strong>Impact:</strong> Anyone can read the private data, breaking the protocol rule.<p><strong>Proof of Concept:</strong><ol><li>Start the local chain</ol><pre class=language-shell data-lang=shell style=color:#61676c;background-color:#fafafa><code class=language-shell data-lang=shell><span>$ make anvil
</span></code></pre><ol start=2><li>Deploy the contract</ol><pre class=language-shell data-lang=shell style=color:#61676c;background-color:#fafafa><code class=language-shell data-lang=shell><span>$ make deploy
</span></code></pre><ol start=3><li>Get the storage slot data in which our password got stored</ol><pre class=language-shell data-lang=shell style=color:#61676c;background-color:#fafafa><code class=language-shell data-lang=shell><span>$ cast storage &lt;contract_address> 1
</span></code></pre><ol start=4><li>Parse hex to string</ol><pre class=language-shell data-lang=shell style=color:#61676c;background-color:#fafafa><code class=language-shell data-lang=shell><span>$ cast parse-bytes32-string &lt;Output form the above command>
</span></code></pre><p><strong>Recommended Mitigation:</strong> It would be a best practice to not store any private data on-chain since the chain is public to everyone. We should rethink about the architecture because we are going to eliminate the password from the chain. One think we could do is to, encrypt the password off-chain before we store it on-chain. this will lead us to store one key off-chain to decode the encrypted password.<p><br><br><h2 id=h2-passwordstore-setpassword-has-no-access-control-vulnerable-to-non-owner-to-change-it><a aria-label="Anchor link for: h2-passwordstore-setpassword-has-no-access-control-vulnerable-to-non-owner-to-change-it" class=zola-anchor href=#h2-passwordstore-setpassword-has-no-access-control-vulnerable-to-non-owner-to-change-it>[H2] <code>PasswordStore::setPassword</code> has no access control, vulnerable to non-owner to change it.</a></h2><p><strong>Description:</strong> The <code>PasswordStore::setPassword</code> function is intended to trigger only by the owner to change the <code>PasswordStore::s_password</code>. Since the function doesn't have any access control, it allows even a non-owner to change the password.<p><strong>Impact:</strong> Anyone can change the stored password, breaking the contract functional rule.<p><strong>Proof Of Concept:</strong> Let's write a fuzz test to see whether non-owner is able to change the password or not.<pre class=language-bibtex data-lang=bibtex style=color:#61676c;background-color:#fafafa><code class=language-bibtex data-lang=bibtex><span style=color:#abb0b6;font-style:italic>    function testAnyoneCanSetPassword(address nonOwner) external {
</span><span style=color:#abb0b6;font-style:italic>        string memory newPassword = "newPassword";
</span><span style=color:#abb0b6;font-style:italic>        vm.assume(nonOwner != owner );
</span><span style=color:#abb0b6;font-style:italic>
</span><span style=color:#abb0b6;font-style:italic>        vm.prank(nonOwner);
</span><span style=color:#abb0b6;font-style:italic>        passwordStore.setPassword(newPassword);
</span><span style=color:#abb0b6;font-style:italic>
</span><span style=color:#abb0b6;font-style:italic>        vm.prank(owner);
</span><span style=color:#abb0b6;font-style:italic>        string memory updatePassword = passwordStore.getPassword();
</span><span style=color:#abb0b6;font-style:italic>
</span><span style=color:#abb0b6;font-style:italic>        assertEq(newPassword,updatePassword);
</span><span style=color:#abb0b6;font-style:italic>    }
</span></code></pre><p>passing this test tells us that a non-user can update the password.<p><strong>Mitigation:</strong> Add the below lines to make sure only owner can trigger the function.<pre class=language-bibtex data-lang=bibtex style=color:#61676c;background-color:#fafafa><code class=language-bibtex data-lang=bibtex><span style=color:#abb0b6;font-style:italic>    if (msg.sender != s_owner) {
</span><span style=color:#abb0b6;font-style:italic>        revert PasswordStore__NotOwner();
</span><span style=color:#abb0b6;font-style:italic>    }
</span></code></pre><p><br><br><hr><h1 id=low><a aria-label="Anchor link for: low" class=zola-anchor href=#low>Low</a></h1><h2 id=l1-initialization-timeframe-vulnerability><a aria-label="Anchor link for: l1-initialization-timeframe-vulnerability" class=zola-anchor href=#l1-initialization-timeframe-vulnerability>[L1] Initialization Timeframe Vulnerability</a></h2><p><strong>Description:</strong> The PasswordStore contract exhibits an initialization timeframe vulnerability. This means that there is a period between contract deployment and the explicit call to setPassword during which the password remains in its default state. During this initialization timeframe, the contract's password is effectively empty and can be considered a security gap.<p><strong>Impact:</strong> The impact of this vulnerability is that during the initialization timeframe, the contract's password is left empty, potentially exposing the contract to unauthorized access or unintended behavior.<p><strong>Mitigation:</strong> To mitigate the initialization timeframe vulnerability, consider setting a password value during the contract's deployment<hr><h1 id=informative><a aria-label="Anchor link for: informative" class=zola-anchor href=#informative>Informative</a></h1><h2 id=i1-netspec-indicates-a-parameter-that-doesn-t-exist-causing-netspec-incorrect><a aria-label="Anchor link for: i1-netspec-indicates-a-parameter-that-doesn-t-exist-causing-netspec-incorrect" class=zola-anchor href=#i1-netspec-indicates-a-parameter-that-doesn-t-exist-causing-netspec-incorrect>[I1] Netspec indicates a parameter that doesn't exist, causing netspec incorrect.</a></h2><p><strong>Description:</strong> The <code>PasswordStore::getPassword</code> function is not expecting any parameter where in the netSpec says it should be getPassword(string)<p><strong>Impact:</strong> False documentation making confusion for consumers<p><strong>Mitigation:</strong> Remove the unnecessary netSpec line.</section></article></main></div>